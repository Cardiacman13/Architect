#!/usr/bin/env bash

sudo -v

GREEN='\e[32m'  # Green color
RED='\e[31m'    # Red color
PURPLE='\e[35m' # Purple color
RESET='\e[0m'   # Reset color

source src/setup/graphic_card.sh
source src/setup/packages.sh
source src/setup/peripheries.sh
source src/setup/shell.sh
source src/setup/software.sh
source src/setup/system_setup.sh

function install_aur_helper() {
    if ! command -v yay &> /dev/null; then
        git clone https://aur.archlinux.org/yay-bin.git
        cd yay-bin
        makepkg -si --noconfirm
        cd ..
        rm -rf yay-bin
    fi
}

function welcome_msg() {
    echo -e "${GREEN}Bienvenue dans le script d'installation d'Arch Linux !${RESET}"
    echo -e "-----------------------------------------------------------------------------------------------------------

       ${PURPLE}%%%%%%%%%%${RESET}  ${GREEN}*********${RESET}            
       ${PURPLE}%%%${RESET}                 ${GREEN}******${RESET}       
       ${PURPLE}%%%${RESET}                     ${GREEN}***${RESET}      Script d'installation d'Arch Linux
       ${PURPLE}%%%${RESET}                     ${GREEN}***${RESET}      
       ${PURPLE}%%%${RESET}                     ${GREEN}***${RESET}      GitHub : https://github.com/Cardiacman13/Tuto-Arch
       ${PURPLE}%%%${RESET}                     ${GREEN}***${RESET}      
       ${PURPLE}%%%${RESET}                     ${GREEN}***${RESET}      Par https://github.com/Cardiacman13
        ${PURPLE}%%%%%%${RESET}                 ${GREEN}***${RESET}       et https://github.com/wmemcpy
             ${PURPLE}%%%%%%%%${RESET}  ${GREEN}***********${RESET}     

-----------------------------------------------------------------------------------------------------------\n"
}

 


function main() {
    welcome_msg
    local start_time=$(date +%s.%N) 

    if grep -q "^#\[multilib\]" "/etc/pacman.conf"; then
        sudo sed -i '/^#\[multilib\]/,/^#Include = \/etc\/pacman.d\/mirrorlist/ s/^#//' "/etc/pacman.conf"
    fi

    sudo pacman -Syy --noconfirm >> /dev/null 2>&1
    sudo pacman -S --noconfirm git >> /dev/null 2>&1
    install_aur_helper
    yay -S --needed --noconfirm bc lolcat >> /dev/null 2>&1

    system_setup            # 1
    install_video_drivers   # 2
    chose_shell             # 3
    install_peripheries     # 4
    install_useful_packages # 5
    install_useful_software # 6

    sudo pacman -Rs --noconfirm bc lolcat >> /dev/null 2>&1

    local end_time=$(date +%s.%N)
    local duration=$(echo "$end_time - $start_time" | bc)

    echo -e "${GREEN}Le script a mis ${duration} secondes à s'exécuter.${RESET}"
    sleep 1
    echo "Le système redémarre dans 5 secondes ou appuyez sur Ctrl+C pour annuler."
    TMP=10
    while [[ $TMP -gt 0 ]]; do
        echo -e "${RED}Redémarrage dans ${TMP} secondes...${RESET}"
        sleep 1
        ((TMP--))
    done
    sudo reboot
}

main
